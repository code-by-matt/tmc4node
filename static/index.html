<!doctype html>
<html lang="en">
  <head>
    <!-- Meta tags needed to make Bootstrap work. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- My own CSS, favicon, title. -->
    <link rel="stylesheet" type="text/css" href='style.css'>
    <link rel="icon" type="image/png" href='logo.svg'>
    <title>TMC4</title>
  </head>
  <body>
    <div class="container">
      <canvas id="board-canvas" width="1400" height="1200"></canvas>
      <!-- Inline styling of this image is needed to prevent border wiggle in Chrome. -->
      <img class="row" id="board-img" style="border-style: solid">
      <div class="row border flex justify-content-between">
        <canvas id="counter-canvas" width="1600" height="200"></canvas>
        <img class="margin-4" id="counter-img" height="20">
        <button class="margin-4" id="reset">Reset</button>
      </div>
      <div class="row border flex justify-content-between">
        <div class="flex">
          <img class="margin-4" width="20" height="20" style="background-color: #DC3545">
          <div class="margin-4">Player 1</div>
        </div>
        <div class="flex">
          <div class="margin-4">Player 2</div>
          <img class="margin-4" width="20" height="20" style="background-color: #007BFF">
        </div>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src='scripts.js'></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {

        // Initialize variables. 
        var boardImg = document.getElementById("board-img");
        var boardCanvas = document.getElementById("board-canvas");
        var counterImg = document.getElementById("counter-img");
        var counterCanvas = document.getElementById("counter-canvas");
        var gameStats;

        // Establish websocket connection.
        var socket = io();

        // Request the game stats from the server.
        socket.emit('stats request');

        // Change cursor style when appropriate.
        boardImg.addEventListener("mousemove",  function(event) {
          var col = getCol(boardImg, event);
          if (gameStats.openRows[col] < 6) {
            boardImg.style.cursor = "pointer";
          }
          else {
            boardImg.style.cursor = "default";
          }
        });

        // Update gameStats and send it to the server.
        boardImg.addEventListener("click", function(event) {
          var col = getCol(boardImg, event);
          if (gameStats.openRows[col] < 6) {
            updateGameStats(gameStats, col);
            socket.emit('stats', gameStats);
          }
        });

        // Update board and gameStats when server broadcasts stats.
        socket.on('stats', function(newGameStats) {
          gameStats = newGameStats;
          createBoard(boardImg, boardCanvas, gameStats);
          createCounter(counterImg, counterCanvas, gameStats);
        });

        // Reset game when reset is clicked.
        document.getElementById("reset").addEventListener("click", function() {
          resetGameStats(gameStats);
          socket.emit('stats', gameStats);
          console.log("reset!");
        });
        
      });
    </script>
  </body>
</html>

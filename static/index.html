<!doctype html>
<html lang="en">
  <head>
    <!-- Meta tags needed to make Bootstrap work. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- My own CSS, favicon, title. -->
    <link rel="stylesheet" type="text/css" href='style.css'>
    <link rel="icon" type="image/png" href='logo.svg'>
    <title>TMC4</title>
  </head>
  <body>
    <div class="container">
      <div class="regbox">  
        <img src='logo.svg' alt="Thue-Morse Connect Four Logo" title="Thue-Morse Connect Four Logo" width="40" height="40">
        <h3 class="text-center">Thue-Morse Connect Four</h3>
        <canvas id="canvas" style="display:none" width="1400" height="1200"></canvas>
        <img id="board" width="100%" class="card-img rounded-0">
        <a id="reset" href="#" class="btn btn-primary">Reset</a>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src='scripts.js'></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {

        // Initialize variables. 
        var board = document.getElementById("board");
        var canvas = document.getElementById("canvas");
        var gameStats;

        // Establish websocket connection.
        var socket = io();

        // Request the game stats from the server.
        socket.emit('stats request');

        // Change cursor style when appropriate.
        board.addEventListener("mousemove",  function(event) {
          var col = getCol(board, event);
          if (gameStats.openRows[col] < 6) {
            board.style.cursor = "pointer";
          }
          else {
            board.style.cursor = "default";
          }
        });

        // Update gameStats and send it to the server.
        board.addEventListener("click", function(event) {
          var col = getCol(board, event);
          if (gameStats.openRows[col] < 6) {
            updateGameStats(gameStats, col);
            socket.emit('stats', gameStats);
          }
        });

        // Update board and gameStats when server broadcasts stats.
        socket.on('stats', function(newGameStats) {
          gameStats = newGameStats;
          createBoard(board, canvas, gameStats);
        });

        // Reset game when reset is clicked.
        document.getElementById("reset").addEventListener("click", function() {
          resetGameStats(gameStats);
          socket.emit('stats', gameStats);
          console.log("reset!");
        });
        
      });
    </script>
  </body>
</html>
